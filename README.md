# Виртуальный ассистент для персонального компьютера

Ирина - русский голосовой ассистент для работы оффлайн. Требует Python 3.5+ (зависимость может быть меньше, но в любом случае Python 3)

Поддерживает плагины (скиллы).

### Самая быстрая установка под Windows

Зайдите в [репозиторий](https://github.com/voewoda88/VirtualAssistantInstaller), скачайте код (Code/Download ZIP) и следуйте инструкциям.

После установки будут доступны следующие команды: "ирина привет", "ирина подбрось монетку", "ирина подбрось кубик", "ирина игра больше меньше", "ирина таймер три минуты"

Для донастройки или решения проблем запустите `start-settings-manager.bat` для запуска менеджера настроек - вы сможете донастроить плагины, и узнаете дополнительные команды.

### Установка / быстрый старт

Вам потребуется установленный Python (ориентировочно 3.7-3.11).

1. Для быстрой установки всех требуемых зависимостей можно воспользоваться командой:
```pip install -r requirements.txt```
(Для Linux и macOS - предварительно установите пакеты для [audioplayer](https://pypi.org/project/audioplayer/))

2. Для запуска запустите файл **runva_vosk.py** из корневой папки.
По умолчанию он запустит оффлайн-распознаватель vosk для распознавания речи с микрофона, 
и pyttsx движок для озвучивания ассистента 
[Подробнее о pyttsx здесь](https://github.com/nateshmbhat/pyttsx3).

3. После запуска проверить можно простой командой - скажите "Ирина, привет!" в микрофон

**Папка с настройками options появится после первого запуска Ирины, в ней можно поправить настройки.**

### Менеджер настроек

Доступен веб-менеджер настроек через gradio.

Для запуска запустите файл **runva_settings_manager.py** из корневой папки.

### Общая логика

Запуск всех команд начинается с имени ассистента (настраивается в options/core.json, по умолчанию - Ирина). 
Так сделано, чтобы исключить неверные срабатывания при постоянном прослушивании микрофона.
Далее будут описываться команды без префикса "Ирина".

## Плагины

Поддержка плагинов сделана на движке Jaa.py - минималистичный однофайловый движок поддержки плагинов и их настроек.

Плагины располагаются в папке plugins и должны начинаться с префикса "plugins_".

Настройки плагинов, если таковые есть, располагаются в папке "options" (создается после первого запуска).

### Готовые плагины/скиллы (уже в папке plugins)

Для каждого плагина написано, требуется ли онлайн. 
Для отключения удалите из папки plugins

### Менеджер плагинов

Для запуска запустите runva_plugin_installer.py

**Для разработчиков**: если вы хотите добавить свой плагин в этот список для упрощенной установки, вам нужно будет сделать следующее:
1. Разместить плагин на Гитхабе
2. В корне должны лежать файлы типа plugin_x.py. Может быть несколько
3. Если нужно установить дополнительные модули, должен лежать файл requirements.txt
4. Протестируйте возможность установки, запустив runva_plugin_installer, выбрав пункт 0 (Самостоятельно задать адрес Github-проекта с плагином) и установите свой плагин

Пример оформления плагина можно посмотреть в папке plugins

### Настройки ядра (core.json)

Настройки конкретных плагинов лучше смотреть в плагинах

```python
{
    "contextDefaultDuration": 10, # Время в секундах, пока Ирина находится в контексте (контекст используется в непрерывном чате, играх и пр.; в контексте не надо использовать слово Ирина)
    "contextRemoteWaitForCall": false, # должна ли Ирина ждать от клиентов сингнала "Проигрывание ответа закончена, запускаем время для контекста?"
    # официальные клиенты поддерживают contextRemoteWaitForCall, рекомендуется true
    "fuzzyThreshold": 0.5, # (ПРО) Порог уверенности при использовании плагинов нечеткого распознавания команд
    "isOnline": true, # при установке в false будет выдавать заглушку на команды плагинов, требующих онлайн. Рекомендуется, если нужен только оффлайн.
    "linguaFrancaLang": "ru", # язык для конвертации чисел в lingua-franca. Смените, если будете работать с другим языком
    "logPolicy": "cmd", # all|cmd|none . Когда распознается речь с микрофона - выводить в консоль всегда | только, если является командой | никогда
    "mpcHcPath": "C:\\Program Files (x86)\\K-Lite Codec Pack\\MPC-HC64\\mpc-hc64_nvo.exe", # путь до MPC HC, если используете
    "mpcIsUse": true, # используется ли MPC HC?
    "mpcIsUseHttpRemote": true, # MPC HC - включено ли управление через веб-интерфейс?
    "playWavEngineId": "audioplayer", # плагин проигрыша WAV-файлов. Некоторые WAV требуют sounddevice.
    "replyNoCommandFound": "Извини, я не поняла", # ответ при непонимании
    "replyNoCommandFoundInContext": "Не поняла...", # ответ при непонимании в состоянии контекста
    "replyOnlineRequired": "Нужен онлайн", # ответ при вызове в оффлайн функции плагина, требующего онлайн 
    "tempDir": "temp", # папка для временных файлов
    "ttsEngineId": "pyttsx", # используемый TTS-движок
    "ttsEngineId2": "", # 2 используемый TTS-движок. Работает только на локальную озвучку - например, буфера обмена. Вызывается командой say2
    "useTTSCache": false, # при установке true в папке tts_cache будет кэшировать .wav файлы со сгенерированными TTS-движком ответами
    "v": "1.7", # версия плагина core. Обновляется автоматически, не трогайте
    "voiceAssNames": "ирина|ирины|ирину", # Если это появится в звуковом потоке, то дальше будет команда. (Различные имена помощника, рекомендуется несколько)
    "voiceAssNameRunCmd": { # если вы обратитесь к помощнику по этому имени, то в начало вашей команды будет подставлено соответствующее слово
        "альбина": "чатгпт"
    }
}
```

### Отладка и разработка (для разработчиков)

Для отладки можно использовать запуск системы через файл **runva_cmdline.py**. 

Она делает запуск ядра (**VACore in vacore.py**) через интерфейс командной строки, это удобнее, чем голосом диктовать.

* Подключить собственный навык можно, создав плагин в **plugins_**. Смотрите примеры.
* Подключить собственный TTS можно плагином. Как примеры, смотрите plugins_tts_console.py, plugins_tts_pyttsx.py.
* Также, создав собственный **runva_** файл, можно, при желании, подключить свойт Speech-To-Text движок.


## Speech-to-Text через SpeechRecognition

SpeechRecognition - классический движок для запуска распознавания через Google и ряд других сервисов.
Для запуска этого распознавания запустите систему через файл **runva_speechrecognition.py**.

Для работы потребуется:

`pip install PyAudio`

`pip install SpeechRecognition`

**Особенности:** распознавание числительных. Одна и та же фраза распознается так:
* VOSK: таймер десять секунд
* SpeechRecognition (Google): таймер 10 секунд

## Поддержка многоязычности
Проект в целом не предполагает поддержки многоязычности, т.к. использует кастомный парсинг слов в плагинах. 
Но, тем не менее, ядро (**vacore.py**) совершенно не привязано к языку, и вы можете собрать собственную инсталляцию на другом языке, просто переписав для них плагины.

Несколько языковых фраз, определяющих core-поведение языкового помощника (его имя, а также фразы типа "Я не поняла")
настраиваются в файле конфигурации плагина **core**.

## Нечеткая обработка фраз

Поддерживается нечеткая обработка пользовательского ввода.

Для задания порога распознавания есть глобальный параметр fuzzyThreshold в core.json, 
он принимает значения от 0 до 1 (1 - полная уверенность в фразе)


  


